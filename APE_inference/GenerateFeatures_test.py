# -*- coding: utf-8 -*-
# +

from datasets_test.MarioBadescu import MarioBadescu
            
from datasets_test.FableMane import FableMane
            
from datasets_test.goop import goop
            
from datasets_test.TheMaker import TheMaker
            
from datasets_test.JIMMYCHOO import JIMMYCHOO
            
from datasets_test.RalphLauren import RalphLauren
            
from datasets_test.Gucci import Gucci
            
from datasets_test.JVN import JVN
            
from datasets_test.Clarins import Clarins
            
from datasets_test.Evian import Evian
            
from datasets_test.GlowRecipe import GlowRecipe
            
from datasets_test.MelaninHaircare import MelaninHaircare
            
from datasets_test.ViktorRolf import ViktorRolf
            
from datasets_test.FORVRMood import FORVRMood
            
from datasets_test.AtelierCologne import AtelierCologne
            
from datasets_test.FaceGym import FaceGym
            
from datasets_test.LauraMercier import LauraMercier
            
from datasets_test.CANOPY import CANOPY
            
from datasets_test.SephoraFavorites import SephoraFavorites
            
from datasets_test.YvesSaintLaurent import YvesSaintLaurent
            
from datasets_test.MoonJuice import MoonJuice
            
from datasets_test.ArmaniBeauty import ArmaniBeauty
            
from datasets_test.TheOrdinary import TheOrdinary
            
from datasets_test.Mugler import Mugler
            
from datasets_test.EllisBrooklyn import EllisBrooklyn
            
from datasets_test.CLINIQUE import CLINIQUE
            
from datasets_test.PROVENSkincare import PROVENSkincare
            
from datasets_test.CalvinKlein import CalvinKlein
            
from datasets_test.ROSEINC import ROSEINC
            
from datasets_test.ArtistCouture import ArtistCouture
            
from datasets_test.Aquis import Aquis
            
from datasets_test.Kaja import Kaja
            
from datasets_test.iNNBEAUTYPROJECT import iNNBEAUTYPROJECT
            
from datasets_test.EightBob import EightBob
            
from datasets_test.NaturallySerious import NaturallySerious
            
from datasets_test.Tabu import Tabu
            
from datasets_test.Sourse import Sourse
            
from datasets_test.dae import dae
            
from datasets_test.maude import maude
            
from datasets_test.DERMAFLASH import DERMAFLASH
            
from datasets_test.Versace import Versace
            
from datasets_test.FloralStreet import FloralStreet
            
from datasets_test.Susteau import Susteau
            
from datasets_test.Skinfix import Skinfix
            
from datasets_test.DanessaMyricksBeauty import DanessaMyricksBeauty
            
from datasets_test.PeaceOut import PeaceOut
            
from datasets_test.SkinLaundry import SkinLaundry
            
from datasets_test.Tower28Beauty import Tower28Beauty
            
from datasets_test.YouthToThePeople import YouthToThePeople
            
from datasets_test.GXVEBYGWENSTEFANI import GXVEBYGWENSTEFANI
            
from datasets_test.Supergoop import Supergoop
            
from datasets_test.LOrealProfessionnel import LOrealProfessionnel
            
from datasets_test.Lancome import Lancome
            
from datasets_test.DrDennisGrossSkincare import DrDennisGrossSkincare
            
from datasets_test.DUO import DUO
            
from datasets_test.WorldofChrisCollins import WorldofChrisCollins
            
from datasets_test.HERETIC import HERETIC
            
from datasets_test.DOMINIQUECOSMETICS import DOMINIQUECOSMETICS
            
from datasets_test.Caudalie import Caudalie
            
from datasets_test.TOCCA import TOCCA
            
from datasets_test.BASMA import BASMA
            
from datasets_test.CiateLondon import CiateLondon
            
from datasets_test.RareBeautybySelenaGomez import RareBeautybySelenaGomez
            
from datasets_test.Herbivore import Herbivore
            
from datasets_test.MeltCosmetics import MeltCosmetics
            
from datasets_test.KiehlsSince1851 import KiehlsSince1851
            
from datasets_test.ChristopheRobin import ChristopheRobin
            
from datasets_test.MARA import MARA
            
from datasets_test._54Thrones import _54Thrones
            
from datasets_test.CharlotteTilbury import CharlotteTilbury
            
from datasets_test.FashionFair import FashionFair
            
from datasets_test.BenefitCosmetics import BenefitCosmetics
            
from datasets_test.NAILSINC import NAILSINC
            
from datasets_test.StriVectin import StriVectin
            
from datasets_test.Shiseido import Shiseido
            
from datasets_test.KVDBeauty import KVDBeauty
            
from datasets_test.NuFACE import NuFACE
            
from datasets_test.Biossance import Biossance
            
from datasets_test.FentySkin import FentySkin
            
from datasets_test.StTropez import StTropez
            
from datasets_test.Tatcha import Tatcha
            
from datasets_test.Virtue import Virtue
            
from datasets_test.LillyLashes import LillyLashes
            
from datasets_test.Smashbox import Smashbox
            
from datasets_test.TheOutset import TheOutset
            
from datasets_test.ABBOTT import ABBOTT
            
from datasets_test.KILIANParis import KILIANParis
            
from datasets_test.Azzaro import Azzaro
            
from datasets_test.Ceremonia import Ceremonia
            
from datasets_test.Blinc import Blinc
            
from datasets_test.Commodity import Commodity
            
from datasets_test.SoldeJaneiro import SoldeJaneiro
            
from datasets_test.MERIT import MERIT
            
from datasets_test.WestmanAtelier import WestmanAtelier
            
from datasets_test.Dior import Dior
            
from datasets_test.NatashaDenona import NatashaDenona
            
from datasets_test.BURBERRY import BURBERRY
            
from datasets_test.FloraBast import FloraBast
            
from datasets_test.PATMcGRATHLABS import PATMcGRATHLABS
            
from datasets_test.RANAVAT import RANAVAT
            
from datasets_test.FirstAidBeauty import FirstAidBeauty
            
from datasets_test.IsleofParadise import IsleofParadise
            
from datasets_test.fresh import fresh
            
from datasets_test.PATRICKTA import PATRICKTA
            
from datasets_test.BoySmells import BoySmells
            
from datasets_test.KateSomerville import KateSomerville
            
from datasets_test.Montblanc import Montblanc
            
from datasets_test.REFY import REFY
            
from datasets_test.Slip import Slip
            
from datasets_test.LoveShackFancy import LoveShackFancy
            
from datasets_test.ALTERNAHaircare import ALTERNAHaircare
            
from datasets_test.BonParfumeur import BonParfumeur
            
from datasets_test.WASO import WASO
            
from datasets_test.TOMFORD import TOMFORD
            
from datasets_test.Stripes import Stripes
            
from datasets_test.JosieMaran import JosieMaran
            
from datasets_test.MangoPeople import MangoPeople
            
from datasets_test.HERMES import HERMES
            
from datasets_test.HigherDOSE import HigherDOSE
            
from datasets_test.PHLUR import PHLUR
            
from datasets_test.stila import stila
            
from datasets_test.SharkBeauty import SharkBeauty
            
from datasets_test.K18BiomimeticHairscience import K18BiomimeticHairscience
            
from datasets_test.SUNDAYIISUNDAY import SUNDAYIISUNDAY
            
from datasets_test.The7Virtues import The7Virtues
            
from datasets_test.Rabanne import Rabanne
            
from datasets_test.JLoBeauty import JLoBeauty
            
from datasets_test.Buxom import Buxom
            
from datasets_test.OLEHENRIKSEN import OLEHENRIKSEN
            
from datasets_test.HAUSLABSBYLADYGAGA import HAUSLABSBYLADYGAGA
            
from datasets_test.T3 import T3
            
from datasets_test.Viseart import Viseart
            
from datasets_test.KORAOrganics import KORAOrganics
            
from datasets_test.Saie import Saie
            
from datasets_test.MountLai import MountLai
            
from datasets_test.SaintJaneBeauty import SaintJaneBeauty
            
from datasets_test.NARS import NARS
            
from datasets_test.SEPHORACOLLECTION import SEPHORACOLLECTION
            
from datasets_test.VOLUSPA import VOLUSPA
            
from datasets_test.VioletVoss import VioletVoss
            
from datasets_test.shuuemura import shuuemura
            
from datasets_test.Pureology import Pureology
            
from datasets_test.Oribe import Oribe
            
from datasets_test.PaulasChoice import PaulasChoice
            
from datasets_test.SoleilToujours import SoleilToujours
            
from datasets_test.JouerCosmetics import JouerCosmetics
            
from datasets_test.MaisonMargiela import MaisonMargiela
            
from datasets_test.AcquadiParma import AcquadiParma
            
from datasets_test.Gisou import Gisou
            
from datasets_test.Prima import Prima
            
from datasets_test.TheNueCo import TheNueCo
            
from datasets_test.FunctionofBeautyPRO import FunctionofBeautyPRO
            
from datasets_test.Vegamour import Vegamour
            
from datasets_test.HABIT import HABIT
            
from datasets_test.ghd import ghd
            
from datasets_test.TheOriginalMakeUpEraser import TheOriginalMakeUpEraser
            
from datasets_test.SmileMakers import SmileMakers
            
from datasets_test.Glamnetic import Glamnetic
            
from datasets_test.BioIonic import BioIonic
            
from datasets_test.OUIthePeople import OUIthePeople
            
from datasets_test.DrBarbaraSturm import DrBarbaraSturm
            
from datasets_test.Olaplex import Olaplex
            
from datasets_test.KateMcLeod import KateMcLeod
            
from datasets_test._1969 import _1969
            
from datasets_test.INCredible import INCredible
            
from datasets_test.SKII import SKII
            
from datasets_test.SIMIHAZEBEAUTY import SIMIHAZEBEAUTY
            
from datasets_test.CrownAffair import CrownAffair
            
from datasets_test.Hanni import Hanni
            
from datasets_test.philosophy import philosophy
            
from datasets_test.GUERLAIN import GUERLAIN
            
from datasets_test.Briogeo import Briogeo
            
from datasets_test.LaMer import LaMer
            
from datasets_test.NUDESTIX import NUDESTIX
            
from datasets_test.Kopari import Kopari
            
from datasets_test.PeterThomasRoth import PeterThomasRoth
            
from datasets_test.GLOScience import GLOScience
            
from datasets_test.Chloe import Chloe
            
from datasets_test.Algenist import Algenist
            
from datasets_test.Glossier import Glossier
            
from datasets_test.belif import belif
            
from datasets_test.DrZenoviaSkincare import DrZenoviaSkincare
            
from datasets_test.PATTERNbyTraceeEllisRoss import PATTERNbyTraceeEllisRoss
            
from datasets_test.Necessaire import Necessaire
            
from datasets_test.LAWLESS import LAWLESS
            
from datasets_test.DrLaraDevganScientificBeauty import DrLaraDevganScientificBeauty
            
from datasets_test.RosebudPerfumeCo import RosebudPerfumeCo
            
from datasets_test.Kulfi import Kulfi
            
from datasets_test.JoMaloneLondon import JoMaloneLondon
            
from datasets_test.AugustinusBader import AugustinusBader
            
from datasets_test.MILKMAKEUP import MILKMAKEUP
            
from datasets_test.RossanoFerrettiParma import RossanoFerrettiParma
            
from datasets_test.PMD import PMD
            
from datasets_test._5SENS import _5SENS
            
from datasets_test.Viori import Viori
            
from datasets_test.Kosas import Kosas
            
from datasets_test.CinemaSecrets import CinemaSecrets
            
from datasets_test.IconicLondon import IconicLondon
            
from datasets_test.Verb import Verb
            
from datasets_test.WanderBeauty import WanderBeauty
            
from datasets_test.DAMDAM import DAMDAM
            
from datasets_test.BeautyBio import BeautyBio
            
from datasets_test.Moroccanoil import Moroccanoil
            
from datasets_test.Drybar import Drybar
            
from datasets_test.LOccitane import LOccitane
            
from datasets_test.HUDABEAUTY import HUDABEAUTY
            
from datasets_test.LOrealProfessionnelSteampod import LOrealProfessionnelSteampod
            
from datasets_test.AERIN import AERIN
            
from datasets_test.Kerastase import Kerastase
            
from datasets_test.Topicals import Topicals
            
from datasets_test.EsteeLauder import EsteeLauder
            
from datasets_test.ciele import ciele
            
from datasets_test.AnastasiaBeverlyHills import AnastasiaBeverlyHills
            
from datasets_test.Curlsmith import Curlsmith
            
from datasets_test.Givenchy import Givenchy
            
from datasets_test.BREADBEAUTYSUPPLY import BREADBEAUTYSUPPLY
            
from datasets_test.TooFaced import TooFaced
            
from datasets_test.TULASkincare import TULASkincare
            
from datasets_test.COOLA import COOLA
            
from datasets_test.GrandeCosmetics import GrandeCosmetics
            
from datasets_test.Murad import Murad
            
from datasets_test.LANEIGE import LANEIGE
            
from datasets_test.HouseofLashes import HouseofLashes
            
from datasets_test.DrBrandtSkincare import DrBrandtSkincare
            
from datasets_test.superzero import superzero
            
from datasets_test.ByRosieJane import ByRosieJane
            
from datasets_test.ShaniDardenSkinCare import ShaniDardenSkinCare
            
from datasets_test.CHANEL import CHANEL
            
from datasets_test.JuicyCouture import JuicyCouture
            
from datasets_test.EADEM import EADEM
            
from datasets_test.Sulwhasoo import Sulwhasoo
            
from datasets_test.caliray import caliray
            
from datasets_test.MaisonLouisMarie import MaisonLouisMarie
            
from datasets_test.beautyblender import beautyblender
            
from datasets_test.UrbanDecay import UrbanDecay
            
from datasets_test.CommunitySixtySix import CommunitySixtySix
            
from datasets_test.KAYALI import KAYALI
            
from datasets_test.BobbiBrown import BobbiBrown
            
from datasets_test.amika import amika
            
from datasets_test.TWEEZERMAN import TWEEZERMAN
            
from datasets_test.Reverie import Reverie
            
from datasets_test.innisfree import innisfree
            
from datasets_test.DeborahLippmann import DeborahLippmann
            
from datasets_test.Wishful import Wishful
            
from datasets_test.Bumbleandbumble import Bumbleandbumble
            
from datasets_test.adwoabeauty import adwoabeauty
            
from datasets_test.JillianDempsey import JillianDempsey
            
from datasets_test.DolceGabbana import DolceGabbana
            
from datasets_test.TheINKEYList import TheINKEYList
            
from datasets_test.KORRES import KORRES
            
from datasets_test.NurseJamie import NurseJamie
            
from datasets_test.NESTNewYork import NESTNewYork
            
from datasets_test.ONESIZEbyPatrickStarrr import ONESIZEbyPatrickStarrr
            
from datasets_test.ILIA import ILIA
            
from datasets_test.HyperSkin import HyperSkin
            
from datasets_test.JulietteHasaGun import JulietteHasaGun
            
from datasets_test.LivingProof import LivingProof
            
from datasets_test.LYSBeauty import LYSBeauty
            
from datasets_test.AmiCole import AmiCole
            
from datasets_test.TANLUXE import TANLUXE
            
from datasets_test.AlphaH import AlphaH
            
from datasets_test.CLEANRESERVE import CLEANRESERVE
            
from datasets_test.RIES import RIES
            
from datasets_test.Rahua import Rahua
            
from datasets_test.BondiBoost import BondiBoost
            
from datasets_test.SundayRiley import SundayRiley
            
from datasets_test.Touchland import Touchland
            
from datasets_test.COLORWOW import COLORWOW
            
from datasets_test.SKYLAR import SKYLAR
            
from datasets_test.FentyBeautybyRihanna import FentyBeautybyRihanna
            
from datasets_test.MAKEUPFOREVER import MAKEUPFOREVER
            
from datasets_test.DrJart import DrJart
            
from datasets_test.LunaDaily import LunaDaily
            
from datasets_test.tarte import tarte
            
from datasets_test.MAKEUPBYMARIO import MAKEUPBYMARIO
            
from datasets_test.MACRENEactives import MACRENEactives
        
from datasets_test.Valentino import Valentino
        
from datasets_test.IGK import IGK
        
from datasets_test.OTHERLAND import OTHERLAND
        
from datasets_test.bareMinerals import bareMinerals
        
from datasets_test.TataHarper import TataHarper
        
from datasets_test.ActAcre import ActAcre
        
from datasets_test.Nette import Nette
        
from datasets_test.Hourglass import Hourglass
        
from datasets_test.DonnaKaran import DonnaKaran
        
from datasets_test.Nutrafol import Nutrafol
        
from datasets_test.DrunkElephant import DrunkElephant
        
from datasets_test.HenryRose import HenryRose
        
from datasets_test.MarcJacobsFragrances import MarcJacobsFragrances
        
from datasets_test.ITCosmetics import ITCosmetics
        
from datasets_test.LionPose import LionPose
                
from datasets_test.SHAZKIKS import SHAZKIKS
        
from datasets_test.JackBlack import JackBlack
        
from datasets_test.RENCleanSkincare import RENCleanSkincare
        
from datasets_test.MATTEROFFACT import MATTEROFFACT
        
from datasets_test.Dyson import Dyson
        
from datasets_test.GraceEleyae import GraceEleyae
        
from datasets_test.Overose import Overose
        
from datasets_test.FOREO import FOREO
        
from datasets_test.Dermalogica import Dermalogica
        
from datasets_test.OUAI import OUAI
        
from datasets_test.CAYSKIN import CAYSKIN
        
from datasets_test.Mizani import Mizani
        
from datasets_test.Origins import Origins
        
from datasets_test.SOBELSKINRx import SOBELSKINRx
        
from datasets_test.SummerFridays import SummerFridays
        
from datasets_test.ALO import ALO
        
from datasets_test.Prada import Prada
        
from datasets_test.FreckBeauty import FreckBeauty
        
from datasets_test.DedCool import DedCool
        
from datasets_test.VelourLashes import VelourLashes
        
from datasets_test.Farmacy import Farmacy
        
from datasets_test.alpynbeauty import alpynbeauty
        
from datasets_test.CarolinaHerrera import CarolinaHerrera
        
from datasets_test.ROSEIngletonMD import ROSEIngletonMD
# -


import os
import random
import argparse
import yaml
import numpy as np
from tqdm import tqdm

import torch
import torch.nn.functional as F
import torch.nn as nn
import torchvision.transforms as transforms

import clip
from utils import *

class GenerateFeatures:
    def __init__(self, clip_model, preprocess, cls_name=None):
        # self.clip_model, self.preprocess = clip.load('ViT-B/32')
        self.clip_model = clip_model
        self.preprocess = preprocess
        self.cls_name = cls_name
        
    # # 훈련 데이터셋 이미지 특성 추출 : CLIP모델을 사용해서 이미지 특성 추출
    # def extract_few_shot_feature(self, cfg, clip_model, train_loader_cache):
    #     cache_keys = []
    #     cache_values = []
    #     with torch.no_grad():
    #         # Data augmentation for the cache model
    #         for augment_idx in range(cfg['augment_epoch']):
    #             train_features = []
    #             print('Augment Epoch: {:} / {:}'.format(augment_idx, cfg['augment_epoch']))
    #             for i, (images, target) in enumerate(tqdm(train_loader_cache)):
    #                 images = images.cuda()
    #                 image_features = clip_model.encode_image(images)
    #                 train_features.append(image_features)
    #                 if augment_idx == 0:
    #                     target = target.cuda()
    #                     cache_values.append(target)
    #             cache_keys.append(torch.cat(train_features, dim=0).unsqueeze(0))
            
    #     cache_keys = torch.cat(cache_keys, dim=0).mean(dim=0)
    #     cache_keys /= cache_keys.norm(dim=-1, keepdim=True)
    #     cache_keys = cache_keys.permute(1, 0)
    #     cache_values = F.one_hot(torch.cat(cache_values, dim=0)).half()
    #     torch.save(cache_keys, cfg['cache_dir'] + '/keys_' + str(cfg['shots']) + "shots.pt")
    #     # torch.save(cache_keys, cfg['cache_dir'] + '/keys_' + shots + "shots.pt")
    #     torch.save(cache_values, cfg['cache_dir'] + '/values_' + str(cfg['shots']) + "shots.pt")
    #     # torch.save(cache_values, cfg['cache_dir'] + '/values_' + shots + "shots.pt")

    #     return
    
    # Val/test 데이터셋 이미지 특성 추출 : CLIP모델을 사용해서 이미지 특성 추출
    def extract_val_test_feature(self, cfg, split, clip_model, loader):
        features, labels = [], []
        with torch.no_grad():
            for i, (images, target) in enumerate(tqdm(loader)):
                images, target = images.cuda(), target.cuda()
                image_features = clip_model.encode_image(images)
                image_features /= image_features.norm(dim=-1, keepdim=True)
                features.append(image_features)
                labels.append(target)
        features, labels = torch.cat(features), torch.cat(labels)
        torch.save(features, cfg['cache_dir'] + "/" + split + "_f.pt")
        torch.save(labels, cfg['cache_dir'] + "/" + split + "_l.pt")
        return
    
    # 텍스트 특성 추출 : CLIP모델을 사용해서 텍스트 특성 추출(주어진 클래스와 템플릿에 따라 텍스트 구성)
    # def extract_text_feature(self, cfg, classnames, prompt_path, clip_model, template):
    def extract_text_feature(self, cfg, prompt_path, clip_model, template):
    
        f = open(prompt_path)
        prompts = json.load(f)
        with torch.no_grad():
            clip_weights = []
            # for classname in classnames:
            #     # Tokenize the prompts
            #     classname = classname.replace('_', ' ')
                
            #     template_texts = [t.format(classname) for t in template]
            #     cupl_texts = prompts[classname]
            #     texts = template_texts + cupl_texts
            #     texts_token = clip.tokenize(texts, truncate=True).cuda()
            #     # prompt ensemble for ImageNet
            #     class_embeddings = clip_model.encode_text(texts_token)
            #     class_embeddings /= class_embeddings.norm(dim=-1, keepdim=True)
            #     # 평균을 취함으로써 여러 문장의 특징을 하나로 요약하고, 클래스에 대한 종합적인 특성을 나타내는 벡터를 얻을 수 있음
            #     class_embedding = class_embeddings.mean(dim=0)
            #     class_embedding /= class_embedding.norm()
            #     clip_weights.append(class_embedding)
                    # Tokenize the prompts
            # classname = self.cls_name
            # classname = classname.replace('_', ' ')
            
            image_folder = f"./data/cosmetic/images/train/{self.cls_name}"
            class_folders = []

            for folder_name in os.listdir(image_folder):
                folder_path = os.path.join(image_folder, folder_name)
                if os.path.isdir(folder_path):
                    class_folders.append(folder_name)
            for cls in class_folders:
                template_texts = [t.format(cls) for t in template]
                cupl_texts = prompts[cls]
                texts = template_texts + cupl_texts
                texts_token = clip.tokenize(texts, truncate=True).cuda()
                # prompt ensemble for ImageNet
                class_embeddings = clip_model.encode_text(texts_token)
                class_embeddings /= class_embeddings.norm(dim=-1, keepdim=True)
                # 평균을 취함으로써 여러 문장의 특징을 하나로 요약하고, 클래스에 대한 종합적인 특성을 나타내는 벡터를 얻을 수 있음
                class_embedding = class_embeddings.mean(dim=0)
                class_embedding /= class_embedding.norm()
                clip_weights.append(class_embedding)

            clip_weights = torch.stack(clip_weights, dim=1).cuda()
        torch.save(clip_weights, cfg['cache_dir'] + "/text_weights_cupl_t.pt")
        return
    
    def generate_features(self):
        
        # train_path = f'./data/cosmetic/images/train/{self.cls_name}'
        
        # file_list = os.listdir(train_path)
        # image_count = len([filename for filename in file_list if filename.endswith('.jpg')])
        # print(f'폴더 내의 이미지 파일 개수: {image_count}')
    
        # k_shot = image_count
        set = self.cls_name
        
        cfg = yaml.load(open('./configs/{}.yaml'.format(set), 'r'), Loader=yaml.Loader)

        cache_dir = os.path.join('./caches', cfg['dataset'])
        os.makedirs(cache_dir, exist_ok=True)
        cfg['cache_dir'] = cache_dir
        
        random.seed(1)
        torch.manual_seed(1)
        
        
        # 변경된 "shots" 값을 저장합니다.
        with open('./configs/{}.yaml'.format(set), 'w') as yaml_file:
            yaml.dump(cfg, yaml_file, default_flow_style=False)
        
        dynamic_class = globals()[self.cls_name]

        dataset = dynamic_class(cfg['root_path'], cfg['shots'], self.preprocess)
        # dataset = example(cfg['root_path'], cfg['shots'], self.preprocess)
         
        val_loader = torch.utils.data.DataLoader(dataset.test, batch_size=64, num_workers=8, shuffle=False)
        
        # # Construct the cache model by few-shot training set
        # print("\nConstructing cache model by few-shot visual features and labels.")
        # self.extract_few_shot_feature(cfg, self.clip_model, train_loader_cache)
        
        # # val 이미지 특징 추출 (Extract val/test features)
        # print("\nLoading visual features and labels from val and test set.")
        # self.extract_val_test_feature(cfg, "val", self.clip_model, val_loader)
        
        # test 이미지 특징 추출 (Extract val/test features)
        self.extract_val_test_feature(cfg, 'test', self.clip_model, val_loader)
        
        # # self.extract_text_feature(cfg, dataset.classnames, dataset.cupl_path, self.clip_model, dataset.template)
        # self.extract_text_feature(cfg, dataset.cupl_path, self.clip_model, dataset.template)

        

# # inference
# if __name__ == "__main__":
#     class_name = "example"  # Change the class name as needed
#     clip_model, preprocess = clip.load('ViT-B/32')
#     GenerateFeatures = GenerateFeatures(clip_model, preprocess, cls_name = class_name)
#     GenerateFeatures.generate_features()
